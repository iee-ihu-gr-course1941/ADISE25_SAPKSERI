# The Dry Peaks API (Ξερή)
**Χρήστος Σαπουνάς**
**ΑΜ:2021152**

## Τεχνολογίες

* **Backend:** PHP 
* **Database:** MySQL / MariaDB
* **Data Exchange:** JSON

### Περίληψη API
Το "The Dry Peaks API" (ADISE25_SAPKSERI) είναι ένα project για το μάθημα Ανάπτυξη Ανάπτυξη Διαδικτυακών  
Συστημάτων και Εφαρμογών. Το API αφορά το παιχνιδι της ξερής το οποίο είναι ένα παιχνίδι με κάρτες και πόντους.
Βασικοί κανόνες της ξερής είναι: 
1. Μοιράζονται 6 χαρτία στους παίχτες και 4 στο "τραπέζι"
2. Τα χαρτιά στο τραπέζι είναι φανερά αλλα παίζουμε μόνο πάνω στο πρώτο
3. Ο παίχτης ο οποίος έχει σειρά ρίχνει ένα χαρτί στο τραπέζι και μαζεύει τα φυλλα αν:
  * Το χαρτί του παίχτη είναι ίδιο με αυτό στο τραπέζι
  * Το χαρτί του παίχτι είναι βαλές
  * ΞΕΡΗ: αν υπάρχει μόνο ένα φύλλο κάτω και ρίξει τοτε ο παίχτης το ιδιο τότε έχουμε ξερή!
5. Οταν τελιώσουν τα χαρτιά των παιχτών τους μοιράζουμε απο 4 κάρτες στον καθένα
4. Παίζουμε μεχρι να μην υπάρχουν αλλα χαρτιά στο τραπέζι & στην τράπουλα

Στο API υλοποιούνται οι κανόνες, καθώς και βασικές λειτουργίες που θα μπορέσει να χρησιμοποιήσει το frontend
ώστε να υλοποιήθει και το GUI. Βασικές λειτουργίες όπως create,reset,end,update game. Μαζί με τις βασικές λειτουργίες θα υπάρχουν και οι κινήσεις μπορεί να κάνει ο παίχτης(στην προκειμενη περιπτωση να ριξει μία κάρτα στο τραπέζι). Επιπλέον έχει και συναρτησεις που μπορεί να χρησιμοποιήσει το frontend για να δημιουργήσει ή να διαγράψει έναν χρήστη. Επιπλέον υπάρχουν οι καταλληλοι getters που θα μπορέσει να χρησιμοποιήσει το frontend όπου χρειαστεί, για πράδειγμα άν χρειάζεται τα στοιχεια του τρέχων παιχνιδιού τότε θα καλέσει απο τον server την συνάρτηση getgame($gameid). Η τεχνολογία με την οποία επικοινωνεί το frontend και το backend είναι με json δηλαδη στον παραπάνω παραδειγμα μας για να καλέσει την συναρτηση το frontend θα πρέπει να δωσει ένα json με το gameid: 
```json 
  {
    "gameid":"0123456789"
  }
```
και το backend θα επιστέψει πάλι json με τα στοιχεία τα οποία ζητήσαμε:
```json 
  {
        "gameid":"0123456789",
        "p1" :"p123123",
        "p2" :"p223123",
        "turn" :"p123123",
        "deckofcards" :"{json with deck of cards}",
        "boardofcards" :"{jason with deck of cards}"
  }
```

### Αρχεία & Τρόπος λειτουργείας Αρχείων

**TheDryPeaks.php:** Το αρχείο TheDryPeaks.php είναι το entry point του API. Είναι το αρχείο το οποίο καλείται απο το frontend αν θέλει αν καλέσει μια συνάρτηση το frontend απο τον server. Υπάρχει ένα switch το οποίο ανακατευθυνει κατάλληλο κομματι του κώδικα. Για να καλεστεί η συναρτηση getgame() που προαναφέραμε θα πρέπει να καλεσθεί το /TheDryPeaks.php/game/game με μέθοδο GET και με τα request ανάμεσα απο το τις '/' ανακατευυνομαστε στο κομματι κωδικα:
'''php
  if(isset($input['gameid'])){
    $data = getgame($input['gameid']);
    echo json_encode($data);
  }else {
    http_response_code(400);
    echo json_encode(['error' => 'Missing game id to get game']);
  }
'''
Όπου καλούμε την συνάρτηση απο το game.php, το ίδιο επαναλαμβανεται για όλες τις συναρτησεις του API.

**user.php:** Στο αρχείο user.php βρίσκονται οι συναρτήσεις που αφορούν τους χρήστες που έχουμε αποθηκευμένους στην βάση μας.
  * **createuser($username,$pword):** συνάρτηση που εισχωρουμε τον χρήστη στην βάση και του αναθέτουμε ένα μοναδικό ID μαζί με το username και το password και επιστρέφει status επιτυχίας, "INSERT_SUCCESS" μαζι με το μοναδικό ID του χρήστη.
  * **deleteuser($userid):** συναρτηση διαγραφής χρήστη που ως status επιτυχίας, "DELETE_SUCCESS" μαζί με το id του χρήστη που διαγράψαμε.
  * **checkCredentials($username, $password):** Συνάρτηση που μπορούμε να καλέσουμε για να ελέγψουμε αν τα στοιχεία που έβαλε ο χρήστης είναι σωστά ώστε να μπορέσουμε να τον συνέσουμε στον λογαριασμό του.
  * **getIn_game_state($userid):** Επιστρέφει αν ο χρήστης παίζει παιχνίδι εκείνη την στιγμή
  * **getusername($userid):**Επιστρέφει τον username του χρήστη
  * **getpoints($userid):**Επιστρέφει τα points του χρήστη
  * **getUsersGameID($userid):**Επιστρέφει το gameid του παιχνιδιου που βρίσκεται ο χρήστης
  * **getuserStats($userid):**Επιστρέφει το username,state και τους πόντους του χρήστη

**conn.php:** Συνδέει το php αρχείο μας με την mysql βάση και όπου για να επιτύχουμε χρείαζόμαστε ένα αρχείο 'dbpassag.php' το οποίο περιέχει τους κωδικούς κ.λ.π.
'''php
  <?php 
  $DB_USER ='';
  $DB_PASS ='';
  $DB_SOCKET ='';
  $DB='';
  $DB_PORT=;
  ?>
'''
**match.php:** Βρίσκονται οι συναρτήσεις που θα χρειαστεί το front end για να μπει ο χρήστης σε ουρα παιχνιδιου εύρεσης αντιπάλου.Το μόνο που χρειάζεται να χρησιμοποιηθεί απο το αρχείο αυτό είναι η συνάρτηση inqueue($userid) που "κανονίζει" τα πάντα, δηλαδή μόλις καλεστεί η συνάρτηση τότε ψάχνουμε να βρούμε άλλους παίχτες στην ουρά. Αν υπάρχουν τότε η συναρτηση μας γυρίζει status "GAME_JOINED" και το game id που μόλις συνδέθηκε, αλλιώς δημιουργούμε παιχνίδι και επιστέφουμε status "GAME_CREATED" και το game id που μόλις δημιουργήθηκε. Εφόσον το παιχνίδι δημιουργείται πριν βρεθεί δεύτερος παιχτης, οι κάρτες του αποθηκεύνται στην βάση μας και θα τις χρησιμοποιούμε όταν συνδέεται και ο 2ος παίχτης

**game.php:** Στο αρχείο game βρίσκονται οι συναρτήσεις για την δημιουργία,επανεκκίνηση,λήψη και ενημέρωση παιχνιδιου καθώς και οι κύριες συναρτήσεις του παιχνιδίου που προαναφέραμε καθώς και ορισμένοι getters.
  * **creategame($user1,$user2):** Η συνάρτηση όπου δημιουργούμε το παιχνίδι καλώντας πρώτα την συνάρτηση sharecards() η οποία μας επιστρέφει τις κάρτες παίχτη1,παιχτη2, τις καρτες που θα μοιραστούν στο τραπέζι, και τις καρτες της τράπουλας. Τέλος εισχωρούμε τα δεδομένα στη βάση δημιουργώντας ένα νέο παιχνίδι και εισχωρόντας τις κάρτες στον παίχτη και αλλάζοντας το in_game_state του. Επιστρέφουμε game id και τις κάρτες του 2ου παίχτη.
  * **endgame($gameid):**Διαγράφουμε το παιχνίδι απο την βάση και επιστρέφουμε status "DELETE_SUCCESS"
  * **resetgame($gameid, $usr1, $usr2):**Επανεκινούμε το παιχνίδι με τους ίδιους παίχτες αλλα διαφορετικό game id.
  * **updategame($gameid, $cards, $turn, $boardcards, $gamepoints,$userid,$cardsgathered):** Ενημερώνουμε το game στην βάση με καινουργια δεδομένα.
  * **updategamepoints($userid,$gamepoints):**Ανανεόνουμε τους πόντους του παίχτη.
  * **finishgame($gameid):** Η συνάρτηση finishgame καλείται πριν την συνάρτηση endgame καθώς στην συνάρτηση υπολογίζουμε το νικητή ή την ισσοπαλία του παιχνιδιού και τα αποθηκεύουμε στην βάση μας σε ένα log_game_file στο οποίο βρίσκονται όλα τα παιχνίδια που έχουν παίξει στην εφαρμογή μας στον παρελθον.
  * **sharecards():** Η συνάρτηση η οποία καλείται για να μοιραστούν οι κάρτες στην αρχή του παιχνιδιού. Η συνάρτηση παιρνει τις καρτες οι οποίες είναι στο αρχείο deck.json τις "ανακατεύει" και τις επιστρέφει αναλόγως το μερίδιο που δικαιούται ο παιχτης1, παιχτης 2 κ.λ.π.
  * **throwcard($gameid,$cardnumber):** Η πιο σημαντική συνάρτηση του παιχνιδιού. Στην συνάρτηση throwcard το frontend στέλνει μονο το gameid και το νούμερο της κάρτας που θέλει να ρίξει ο χρήστης και μέσω της βάσης γνωρίζουμε ποιός έχει σειρά να παίξει.
  Αναλόγως με την κάρτα που βρίσκεται στην κορυφη των καρτών στο τραπέζι εφαρμόζεται και ο κατάλληλος κανόνας που αναφέρθηκε στην περίληψη. Πριν απο κάθε επιστροφή της συνάρτησης ελέγχουμε αν οι παίχτες έχουν κάρτες για να τους ξαναμοιράσουμε κάρτες ή αν το παιχνίδι ΤΕΛΕΊΩΣΕ.Η συνάρτηση επιστρέφει την ενέργεια που έγινε(π.χ."GAINED_CARDS","NO_ACTION"κ.λ.π.), το status(π.χ."PLAYING","GAME_OVER","ROUND_ENDED"), την κάρτα που έπαιξε ο παίχτης και την κάρτα που έπαιξε "πάνω". Στη περίπτωση του GAME_OVER καλούμε την συνάρτηση finishgame().
  * **RoundShareCards($gameid):** Η συνάρτηση που καλούμε μετά του κάθε γύρου η οποία παίρνει καρτες απο την τράπουλα που είναι αποθηκευμένη στην βάση και μοιράζει κάρτες στους παίχτες.


## Βάση Δεδομένων








